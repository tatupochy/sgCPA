{% extends 'base.html' %}
{% load static %}
{% block content %}
<h2 class="mt-4 mb-3">Listado de Cursos</h2>

<!-- <form class="mb-3" method="GET" action="">
  <label for="activo" class="form-label">Filtrar por estado:</label>
  <select id="activo" name="activo" class="form-select">
      <option value="">Todos</option>
      <option value="1">Activos</option>
      <option value="0">No Activos</option>
  </select>
  <button type="submit" class="btn btn-primary">Filtrar</button>
</form> -->

<div class="mb-3">
  <label for="filterStatus" class="form-label">Filtrar por estado:</label>
  <select id="filterStatus" class="form-select">
    <option value="">Todos</option>
    <option value="Activo">Activo</option>
    <option value="Inactivo">Inactivo</option>
  </select>
</div>

<table class="table table-hover table-bordered table-striped" id="tablaCursos">
  <thead>
    <tr>
      <th scope="col">Año</th>
      <th scope="col">Nombre del Curso</th>
      <th scope="col">Turno</th>
      <th scope="col">Sección</th>
      <th scope="col">Profesor</th>
      <th scope="col">Fecha de Inicio</th>
      <th scope="col">Estado</th>
      <th scope="col">Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for curso in cursos %}
    <tr>
      <td>{{ curso.year }}</td>
      <td>{{ curso.name }}</td>
      <td>{{ curso.shift }}</td>
      <td>{{ curso.section }}</td>
      <td>{{ curso.teacher.name }} {{ curso.teacher.lastName }}</td>
      <td>{{ curso.start_date|date:"d/m/Y" }}</td>
      <td>
        {% if curso.active %}
            Activo
        {% elif curso.active is None %}
            Pendiente
        {% else %}
            Inactivo
        {% endif %}
    </td>
      <td>
        <a href="{% url 'editar_curso' curso.id %}" class="btn btn-primary btn-sm"><i class="bi bi-pencil-fill"></i> Editar</a>
        <a href="{% url 'borrar_curso' curso.id %}" class="btn btn-danger btn-sm"><i class="bi bi-trash-fill"></i> Borrar</a> 
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}

{% block scripts %}
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.6.2/css/buttons.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.print.min.js"></script>
<script>
  $(document).ready(function() {
      var table = $('#tablaCursos').DataTable({
          dom: 'Bfrtip',
          searching: true,
          buttons: [
              'copy', 'excel', 'csv',
              {
                  extend: 'pdfHtml5',
                  text: 'PDF',
                  title: 'Listado de Cursos',
                  filename: function() {
                      var d = new Date();
                      var datestring = d.getFullYear() + "-" + ("0"+(d.getMonth()+1)).slice(-2) + "-" + ("0" + d.getDate()).slice(-2) + "_" + ("0" + d.getHours()).slice(-2) + ("0" + d.getMinutes()).slice(-2);
                      return 'ListadoCursos_' + datestring;
                  },
                  exportOptions: {
                      columns: [0, 1, 2, 3, 4, 5, 6] // Especifica las columnas a exportar
                  },
                  customize: function(doc) {
                      doc.styles.tableHeader.alignment = 'left';
                      // Asegura que los anchos de tabla estén configurados
                      if (doc.content[1] && doc.content[1].table && doc.content[1].table.body) {
                          doc.content[1].table.widths = Array(doc.content[1].table.body[0].length + 1).join('*').split('');
                      }
                      // Alinea las celdas de encabezado a la derecha
                      doc.styles.tableHeader.alignment = 'right';
                  }
              }
          ],
          language: {
              "lengthMenu": "Mostrar _MENU_ registros por página",
              "zeroRecords": "No se encontraron resultados",
              "info": "Mostrando página _PAGE_ de _PAGES_",
              "infoEmpty": "No hay registros disponibles",
              "infoFiltered": "(filtrado de _MAX_ registros totales)",
              "search": "Buscar:",
              "paginate": {
                  "first": "Primero",
                  "last": "Último",
                  "next": "Siguiente",
                  "previous": "Anterior"
              },
              "buttons": {
                  "copy": "Copiar",
                  "excel": "Excel",
                  "csv": "CSV",
                  "pdf": "PDF",
                  "print": "Imprimir"
              }
          }
      });

      // Agregar un listener para filtrar por estado
      $('#filterStatus').on('change', function() {
          var status = $(this).val();
          if (status) {
              table.column(6).search('^' + status + '$', true, false).draw(); // Buscar coincidencia exacta
          } else {
              table.column(6).search('').draw(); // Mostrar todos
          }
      });
  });
</script>
<script src="{% static 'scripts/script.js' %}"></script>
{% endblock %}